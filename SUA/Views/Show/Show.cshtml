@model SUA.Models.Show
<style>
    table {
        border-spacing: 20px;
    }

    td {
        padding: 10px;
    }
</style>

<div class="main-content">
    @using (Html.BeginForm("Show", "Show", FormMethod.Post, new { enctype = "multipart/form-data" }))
    {
        if (ViewBag.mensaje == "creado")
        {
            <label>El show ha sido cargado con éxito. Puede verlo cargado en el <a href="@Url.RouteUrl("Shows")">Listado de shows</a></label>
        }
        else if (ViewBag.mensaje == "actualizado")
        {
            <label>El show ha sido actualizado con éxito. Puede ver los cambios en el <a href="@Url.RouteUrl("Shows")">Listado de shows</a></label>
        }
        else if (ViewBag.mensaje == "Get")
        {
            <div class="panel">
                <div class="panel-body">
                    <form data-id="" id="pdf-create-form" to-action="/pdfs/create">

                        <table style="border-spacing: 20px">
                            <tr>
                                <td>
                                    <label>Show </label>
                                    @Html.TextBoxFor(model => model._Show, new { @class = "form-control", Style = "width:300px", required = "required" })
                                </td>
                                <td>
                                    <label>Nombre </label>
                                    @Html.TextBoxFor(model => model.Nombre, new { @class = "form-control", Style = "width:300px", required = "required" })
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label>Standuperos </label>
                                    <select multiple="multiple" class="form-control" id="standuperos">
                                        @foreach (var item in ViewBag.standuperos)
                                        {
                                            <option value="@item.Dni">@item.Nombre @item.Apellido</option>
                                        }
                                    </select>
                                    <input type="button" value="Agregar" class="form-control" id="agregar" />
                                </td>
                                <td>
                                    <label>Standuperos Seleccionados</label>
                                    <select multiple="multiple" class="form-control" id="standuperosSeleccionados" name="standuperosSeleccionados" required>
                                        @if (ViewBag.accion == "Put")
                                        {
                                            foreach (var item in Model.Integrantes)
                                            {
                                                <option value="@item.Dni">@item.Nombre @item.Apellido</option>
                                            }
                                        }
                                    </select>
                                    <input type="button" value="Borrar" class="form-control" id="borrar" />
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label>Productor</label>
                                    <select name="productorList" class="form-control" id="productorList" required>
                                        @foreach (var item in ViewBag.productores)
                                        {
                                            <option value="@item.Dni">@item.Nombre @item.Apellido</option>
                                        }
                                    </select>
                                </td>
                                <td>
                                    <label>Sigla Bordereaux</label>
                                    @Html.TextBoxFor(model => model.SiglaBordereaux, new { @class = "form-control", Style = "width:100%", @placeholder = "mayuscula o minuscula", required = "required" })
                                </td>
                            </tr>
                        </table>
                        <hr style="color: #8dd9f7">
                        <table>
                            <tr>
                                <td>
                                    <select class="form-control" id="listaCiudad">
                                        <option>Ciudad 1</option>
                                    </select>
                                    <input type="number" id="cantidadDias" class="form-control" placeholder="dias" min="30" max="365" />
                                    <input type="button" id="agregarRepeticion"  value="Agregar" class="form-control"/>
                                    <select multiple="multiple" class="form-control" id="repeticion" name="repeticion" Style="width:300px; height:124px">
                                        @if (ViewBag.accion == "Put")
                                        {
                                            foreach (var item in Model.Repeticion)
                                            {
                                                <option>@item</option>
                                            }
                                        }
                                    </select>
                                    <input type="button" value="Borarr" class="form-control" id="borrarRepeticion" />
                                </td>
                            </tr>
                        </table>
                        <hr style="color: #8dd9f7">
                        <table>
                            <tr>
                                <td colspan="2">
                                    <label>Rider </label>
                                    @Html.TextAreaFor(model => model.Rider, new { @class = "form-control", Style = "width:100%; height: 130px", required = "required" })
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <label>Camarin </label>
                                    @Html.TextBoxFor(model => model.Camarin, new { @class = "form-control", Style = "width:100%", required = "required" })
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <label>Observaciones </label>
                                    @Html.TextAreaFor(model => model.Observaciones, new { @class = "form-control", Style = "width:100%; height:120px", required = "required" })
                                </td>
                            </tr>
                        </table>
                        <hr style="color: #8dd9f7">
                        <table>
                            <tr>
                                <td>
                                    <label>Color Fondo Calendario</label>
                                    @Html.DropDownListFor(model => model.BackgroundColorCalendar, new SelectList(ViewBag.colores, "Text", "Value"), new { @class = "form-control", Style = "width:300px", required = "required" })
                                </td>
                                <td>
                                    <label>Color Texto Calendario</label>
                                    @Html.DropDownListFor(model => model.TextColorCalendar, new SelectList(ViewBag.colores, "Text", "Value"), new { @class = "form-control", Style = "width:300px", required = "required" })
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label>ID Google Calendar</label>
                                    @Html.TextBoxFor(model => model.GoogleCalendarId, new { @class = "form-control", Style = "width:100%", @placeholder = "Url", required = "required" })
                                </td>
                            </tr>

                        </table>
                        <hr style="color: #8dd9f7">


                        <input name="accion" class="hidden" value="@ViewBag.accion" />
                        <input id="_standuperos" name="_standuperos" class="hidden" />
                        <input id="_productor" name="_productor" class="hidden" />
                        @Html.TextBoxFor(model => model.UniqueId, new { @class = "hidden" })


                        <button id="btn_guardar" type="submit" class="btn btn-primary btn-block btn-submit-to-right">Guardar</button>
                    </form>
                </div>
            </div>
        }
        else
        {
            <label>@ViewBag.mensaje</label>
        }
    }
</div>

<script>

    var accion = "@ViewBag.accion";
    if (accion == "Put")
    {
        //selecciono el productor
        $("#productorList").val("@ViewBag.productor");

        //seteo productor hidden field
        var productorId = $("#productorList option:selected").val();
        $("#_productor").val(productorId);

        //selecciono ultimo item de standuperosSeleccionados
        $("#standuperosSeleccionados option:last").attr("selected", "selected");
        generateStanduperosHiddenList();
    }

    $("#agregar").click(function (event) {
        var seleccion = $("#standuperos option:selected");
        if (seleccion.val() == undefined)
            alert("Debe seleccionar un standupero");
        else
        {
            $("#standuperosSeleccionados").append('<option value="' + seleccion.val() + '">' + seleccion.html() + '</option>');
            $("#standuperos option[value='" + seleccion.val() + "']").remove();

            //selecciono el ultimo standupero
            $("#standuperosSeleccionados").val(seleccion.val());
            generateStanduperosHiddenList();
        }

    });

    $("#borrar").click(function (event) {
        var seleccion = $("#standuperosSeleccionados option:selected");
        if (seleccion.val() == undefined)
            alert("Debe seleccionar un standupero");
        else
        {
            $("#standuperos").append('<option value="' + seleccion.val() + '">' + seleccion.html() + '</option>');
            $("#standuperosSeleccionados option[value='" + seleccion.val() + "']").remove();

            //selecciono el ultimo standupero
            $("#standuperosSeleccionados option:last").attr("selected", "selected");
            generateStanduperosHiddenList();
        }
    });

    function generateStanduperosHiddenList()
    {
        var list = $("#standuperosSeleccionados");
        var i = 0;
        var _standuperos = "";
        while (list[0].children[i] != undefined) {
            if (_standuperos == "")
                _standuperos = list[0].children[i].value;
            else
                _standuperos = _standuperos + "-" + list[0].children[i].value;
            i++;
        }
        $("#_standuperos").val(_standuperos);
    }

    $("#productorList").change(function () {
        $("#_productor").val($("#productorList option:selected").val());
    });

    $("#agregarRepeticion").click(function (event) {

        if ($("#cantidadDias").val() != "" && parseInt($("#cantidadDias").val()) > 0 && parseInt($("#cantidadDias").val()) <= 365 )
        {
            $("#repeticion").append('<option>' + $("#listaCiudad").val() + ' (' + $("#cantidadDias").val() + ' días)</option>');
        }
        else
        {
            alert("Debe seleccionar la cantidad de días a repetir la plaza");
        }

    });

    $("#borrarRepeticion").click(function (event) {
        var seleccion = $("#repeticion option:selected");
        if (seleccion.val() == undefined) {
            alert("Debe seleccionar una plaza");
        }
        else {
            $("#repeticion option:selected").remove();
            generateImpuestosHiddenList();
        }
    });


</script>
