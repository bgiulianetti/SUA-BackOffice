@{
    ViewBag.Title = "Inicio";
}

<style>
    .btn span.glyphicon {
        opacity: 0;
    }

    .btn.active span.glyphicon {
        opacity: 1;
    }
</style>

<div class="main-content">


    <div class="panel">
        <div class="panel-body" style="padding-left:130px; padding-right:130px; padding-top:50px; padding-bottom:60px">

            <div class="well well-sm text-center">
                <h4>Mostrar Show</h4>

                <div class="btn-group" data-toggle="buttons">

                    <label id="201809251121934" title="Sanata" class="btn btn-success active">
                        <input id="check201809251121934" type="checkbox" autocomplete="off" checked>
                        <span class="glyphicon glyphicon-ok"></span>
                    </label>
                    <label id="201809251401711" title="Nicolas De Tracy" class="btn btn-primary active">
                        <input id="check201809251401711" type="checkbox" autocomplete="off" checked>
                        <span class="glyphicon glyphicon-ok"></span>
                    </label>

                    <label id="201809300847352" title="Laila y Gonzo" class="btn btn-danger active">
                        <input id="check201809300847352" type="checkbox" autocomplete="off" checked>
                        <span class="glyphicon glyphicon-ok"></span>
                    </label>

                    <label id="201810021209749" title="El Innombrable" class="btn btn-warning active">
                        <input id="check201810021209749" type="checkbox" autocomplete="off" checked>
                        <span class="glyphicon glyphicon-ok"></span>
                    </label>

                </div>
            </div>
            <div id='calendar'></div>
        </div>
    </div>



</div>
<script>
    $(document).ready(function ()
    {
        //var calendars = @Html.Raw(Json.Encode(@ViewBag.fechas));
        getCalendarsAndDrawCalendar("initial");

        $("#201809251121934").bind('click', getCalendarsAndDrawCalendar);
        $("#201809251401711").bind('click', getCalendarsAndDrawCalendar);
        $("#201809300847352").bind('click', getCalendarsAndDrawCalendar);
        $("#201810021209749").bind('click', getCalendarsAndDrawCalendar);
    });



    function getCalendarsAndDrawCalendar(state)
    {
        $.get("@ViewBag.CalendarsFullUrl", function (data)
        {
            if (!$("#check201809251121934")[0].checked)
                data = DeleteItemArray(data, "201809251121934");
            if (!$("#check201809251401711")[0].checked)
                data = DeleteItemArray(data, "201809251401711");
            if (!$("#check201809300847352")[0].checked)
                data = DeleteItemArray(data, "201809300847352");
            if (!$("#check201810021209749")[0].checked)
                data = DeleteItemArray(data, "201810021209749");

            if (state == "initial")
                drawCalendar(data);
            else
                reDrawCalendar(data);
        });
    }

    function DeleteItemArray(array, id)
    {
        var newArray = [];
        for (var i = 0; i < array.length; i++)
        {
            if (array[i].uniqueId != id)
                newArray.push(array[i]);
        }
        return newArray;
    }

    function drawCalendar(calendars)
    {
        $('#calendar').fullCalendar({
            header: {
                left: 'prev,next today',
                center: 'title',
                right: 'month,agendaWeek,listMonth'
            },
            googleCalendarApiKey: '@ViewBag.Key',
            eventSources: calendars,
            eventClick: function (event)
            {
                window.open(event.url, '_blank', 'width=700,height=600');
                return false;
            }
        });
        $('#calendar').fullCalendar('rerenderEvents');
    }

    function reDrawCalendar(calendars)
    {
        $('#calendar').fullCalendar('destroy');
        drawCalendar(calendars);
    }
</script>
